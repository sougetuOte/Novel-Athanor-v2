# 重要なアーキテクチャ決定事項（ADR サマリ）

## ADR 一覧

| ADR | タイトル | ステータス | 日付 |
|-----|---------|----------|------|
| 0001 | 3プロジェクト統合方針 | Accepted | 2026-01-24 |
| 0002 | 4段階AI可視性システム | Accepted | 2026-01-24 |
| 0003 | 伏線管理システム | Accepted | 2026-01-24 |
| 0004 | データ形式とObsidian統合 | Accepted | 2026-01-24 |
| 0005 | 半自動化アプローチ | Accepted | 2026-01-24 |
| 0006 | The Relay ワークフロー | Accepted | 2026-01-24 |

---

## ADR-0001: 3プロジェクト統合方針

**決定**: 新規設計（3プロジェクト統合）を採用

**理由**:
- 「伏線管理」を中核に据えるには新規設計が最適
- 既存コードの制約を受けない理想的なアーキテクチャ設計が可能
- 技術的負債なしでスタート

**却下した選択肢**:
- Novel-Athanor ベース: エージェント追加の負担が大きい
- NovelWriter ベース: 完全自動志向でユーザー協調と合わない

---

## ADR-0002: 4段階AI可視性システム

**決定**: 4段階可視性システムを採用

| Level | 名称 | AIの認識 | AIの行動 |
|-------|------|---------|---------|
| 0 | 完全秘匿 | 存在すら知らない | 言及不可 |
| 1 | 認識のみ | 「何かある」と知る | 匂わせのみ |
| 2 | 内容認識 | 内容を知っている | 直接言及禁止 |
| 3 | 使用可能 | 完全に把握 | 自由に使用 |

**理由**:
- 「半自動小説生成」の差別化ポイント
- 伏線管理との相乗効果
- Level 2（知っているけど書かない）は業界初

---

## ADR-0003: 伏線管理システム（Chekhov's Gun Tracker）

**決定**: 完全版（状態管理 + 微細度 + AI可視性自動連携）を採用

**状態遷移**:
```
planted → growing → ready → harvested
                  ↘ abandoned
```

| 状態 | デフォルト可視性 |
|------|-----------------|
| planted | Level 1（認識のみ） |
| growing | Level 2（内容認識） |
| ready | Level 3（使用可能） |
| harvested | Level 3 |
| abandoned | Level 0（完全秘匿） |

**微細度スケール**: 1-10（プリセット: 低/中/高）

**理由**:
- 既存3プロジェクトにない独自機能
- 長編小説での実用性が高い

---

## ADR-0004: データ形式とObsidian統合

**決定**: Markdown + YAML Frontmatter を採用

```markdown
---
type: character
name: 主人公
visibility: 3
---

# 主人公
...
```

**理由**:
- Novel-Athanor の既存資産を最大限活用
- 人間と機械の両方にフレンドリー
- Git 親和性、ベンダーロックインなし

---

## ADR-0005: 半自動化アプローチ

**決定**: Phase-Gate-Approval を採用

```
[自動] 設定分析 → [承認] → [自動] プロット生成 → [承認] → [自動] 章執筆 → [承認]
```

**理由**:
- 「AIとユーザーの協調的創作」というビジョンに合致
- 効率と創作実感のバランス
- 重要決定でのみ人間が判断

**却下した選択肢**:
- 完全自動: 創作の実感が失われる
- 提案型のみ: 判断疲れを起こす

---

## ADR-0006: The Relay ワークフロー

**決定**: リレー型ワークフローを採用

```
Continuity Director → Ghost Writer → Reviewer → Quality Agent
      ↑                                              │
      └──────────────── Feedback Loop ───────────────┘
```

**理由**:
- 各エージェントの責務が明確
- フィードバックループで品質向上
- 承認ゲートを自然に組み込める

**制約**:
- ループ回数上限: 最大3回
- コンテキスト圧縮戦略は別途検討

---

## 参照ドキュメント

- `docs/adr/` - ADR 詳細
- `docs/specs/novel-generator-v2/` - 統合仕様書
