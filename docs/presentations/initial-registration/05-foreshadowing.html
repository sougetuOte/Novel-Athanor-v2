<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>伏線とAI情報制御 - 作品初回登録ガイド</title>
  <link rel="stylesheet" href="assets/styles.css">
</head>
<body>
  <a href="index.html" class="home-link">← 目次に戻る</a>

  <div class="presentation">

    <!-- Slide 1: Title -->
    <section class="slide slide-title active" data-slide="1">
      <h1>伏線とAI情報制御</h1>
      <p class="subtitle">作品初回登録ガイド Part 5</p>
      <p class="tagline">Chekhov's Gun Tracker - 伏線を確実に回収する</p>
    </section>

    <!-- Slide 2: What is Foreshadowing Management -->
    <section class="slide" data-slide="2">
      <h2>伏線管理とは？</h2>

      <div class="concept-box">
        <h3>「チェーホフの銃」を追跡する</h3>
        <p class="lead">「第一幕で壁に銃があれば、第三幕で発砲されなければならない」</p>
      </div>

      <div class="content-grid">
        <div class="card">
          <h3>伏線管理の目的</h3>
          <ul>
            <li><strong>回収忘れ防止</strong>：張った伏線を追跡</li>
            <li><strong>張り忘れ防止</strong>：設置タイミング管理</li>
            <li><strong>ネタバレ防止</strong>：AI情報制御と連携</li>
            <li><strong>効果的な伏線</strong>：微細度の管理</li>
          </ul>
        </div>

        <div class="card">
          <h3>伏線のライフサイクル</h3>
          <div class="flow-vertical" style="margin: 1rem 0;">
            <span style="color: var(--text-muted);">registered（登録）</span>
            <span class="flow-arrow-down">↓</span>
            <span style="color: var(--level-l1);">planted（設置）</span>
            <span class="flow-arrow-down">↓</span>
            <span style="color: var(--level-l2);">reinforced（強化）</span>
            <span class="flow-arrow-down">↓</span>
            <span style="color: var(--status-complete);">revealed（回収）</span>
          </div>
        </div>
      </div>
    </section>

    <!-- Slide 3: Foreshadowing Lifecycle -->
    <section class="slide" data-slide="3">
      <h2>伏線のライフサイクル詳細</h2>

      <div class="content-grid">
        <div class="card">
          <h4>registered（登録済み）</h4>
          <p>アイデアとして登録。まだ本文には出ていない。</p>
          <p style="font-size: 0.9rem; color: var(--text-muted);">AI可視性: Level 0（秘匿）</p>
        </div>

        <div class="card">
          <h4>planted（設置完了）</h4>
          <p>本文中に伏線が張られた状態。</p>
          <p style="font-size: 0.9rem; color: var(--text-muted);">AI可視性: Level 1-2（認識/内容認識）</p>
        </div>

        <div class="card">
          <h4>reinforced（強化済み）</h4>
          <p>伏線が補強された。読者に再認識させた。</p>
          <p style="font-size: 0.9rem; color: var(--text-muted);">AI可視性: Level 2（内容認識）</p>
        </div>

        <div class="card">
          <h4>revealed（回収完了）</h4>
          <p>伏線が回収された。読者に明かされた。</p>
          <p style="font-size: 0.9rem; color: var(--text-muted);">AI可視性: Level 3（使用可能）</p>
        </div>
      </div>

      <div class="summary-box">
        <p><strong>ポイント</strong>：ステータスが変わると、AI可視性も自動的に推奨レベルに更新されます。</p>
      </div>
    </section>

    <!-- Slide 4: Subtlety Level -->
    <section class="slide" data-slide="4">
      <h2>微細度スケール（Subtlety Level）</h2>
      <p>伏線の「さりげなさ」を1-10で指定</p>

      <div class="content-grid">
        <div class="card">
          <h4>1-2: 明白</h4>
          <p>読者が即座に「これは伏線だ」と気づく</p>
          <div class="example-box" style="font-size: 0.85rem;">「いつかこれが役立つ時が来る」
という台詞</div>
        </div>

        <div class="card">
          <h4>3-4: 標準</h4>
          <p>注意深い読者なら気づく</p>
          <div class="example-box" style="font-size: 0.85rem;">意味深な描写、
繰り返される小道具</div>
        </div>

        <div class="card">
          <h4>5-6: 微細</h4>
          <p>初読では気づきにくい</p>
          <div class="example-box" style="font-size: 0.85rem;">何気ない会話の中の情報、
背景描写の一部</div>
        </div>

        <div class="card">
          <h4>7-8: 隠れ</h4>
          <p>再読時に初めて意味がわかる</p>
          <div class="example-box" style="font-size: 0.85rem;">キャラクターの無意識の癖、
比喩や象徴表現</div>
        </div>

        <div class="card">
          <h4>9-10: 極微細</h4>
          <p>回収時に「そういえば」と思い出す程度</p>
          <div class="example-box" style="font-size: 0.85rem;">一度だけの短い描写、
省略や暗示</div>
        </div>
      </div>
    </section>

    <!-- Slide 5: Registration Format -->
    <section class="slide" data-slide="5">
      <h2>伏線の登録形式</h2>

      <div class="content-split">
        <div>
          <h4>伏線登録簿（registry.yaml）</h4>
          <div class="example-box" style="font-size: 0.75rem;">foreshadowing:
  - id: FS-03-rocket  # 第3話で植えるロケットの伏線
    title: "主人公のロケット"
    type: character_secret
    status: registered
    subtlety_level: 7

    # AI情報制御
    ai_visibility:
      level: 2
      forbidden_keywords:
        - "王族"
        - "血筋"
      allowed_expressions:
        - "彼女の瞳には見覚えのある光があった"

    # 伏線の内容
    seed:
      content: "主人公が古びたロケットを持っている"
      description: "何気なくロケットを触る描写"

    payoff:
      content: "ロケット内の写真が真実を示す"
      planned_episode: "EP-050"

    # 関連要素
    related:
      characters:
        - "主人公"
        - "謎の老人"</div>
        </div>

        <div>
          <div class="card">
            <h4>ID命名規則</h4>
            <p><code>FS-{episode}-{slug}</code></p>
            <ul>
              <li><strong>FS-03-rocket</strong><br>第3話で植えるロケットの伏線</li>
              <li><strong>FS-08-sealed-door</strong><br>第8話で植える封印された扉</li>
            </ul>
          </div>

          <div class="card" style="margin-top: 1rem;">
            <h4>伏線タイプ</h4>
            <table>
              <tr><th>タイプ</th><th>説明</th></tr>
              <tr><td>character_secret</td><td>キャラの秘密</td></tr>
              <tr><td>plot_twist</td><td>プロットの転換点</td></tr>
              <tr><td>world_reveal</td><td>世界観の真実</td></tr>
              <tr><td>item_significance</td><td>アイテムの重要性</td></tr>
            </table>
          </div>
        </div>
      </div>
    </section>

    <!-- Slide 6: AI Information Control -->
    <section class="slide" data-slide="6">
      <h2>AI情報制御の詳細</h2>

      <div class="concept-box">
        <h3>ユーザーの最重要要件</h3>
        <p class="lead">「AIが設定を知ったことで、意図せずネタバレを文章に混ぜてしまうことを防ぎたい」</p>
      </div>

      <div class="content-split">
        <div>
          <div class="card">
            <h4>forbidden_keywords（禁止キーワード）</h4>
            <p>AIがこれらの語句を使うと警告</p>
            <div class="example-box" style="font-size: 0.85rem;">forbidden_keywords:
  - "王族"
  - "血筋"
  - "高貴"
  - "王家"</div>
          </div>

          <div class="card" style="margin-top: 1rem;">
            <h4>allowed_expressions（許可表現）</h4>
            <p>暗示として使ってよい表現</p>
            <div class="example-box" style="font-size: 0.85rem;">allowed_expressions:
  - "彼女の瞳には見覚えのある光が..."
  - "その立ち振る舞いには育ちの良さが..."</div>
          </div>
        </div>

        <div>
          <div class="card card-warning">
            <h4>Pink Elephant Paradox 対策</h4>
            <p>「〇〇について言及するな」という否定命令は逆効果。</p>
            <p style="margin-top: 0.5rem;">代わりに「情報の不在」を伝える：</p>
            <div class="example-box" style="font-size: 0.85rem; margin-top: 0.5rem;">「{character}の背景の一部は、
現在のコンテキストには含まれていません。
提示された情報のみに基づいて描写してください。」</div>
          </div>
        </div>
      </div>
    </section>

    <!-- Slide 7: Practical Registration -->
    <section class="slide" data-slide="7">
      <h2>実践：伏線の登録手順</h2>

      <div class="content-split">
        <div>
          <h4>対話例</h4>
          <div class="card">
            <p><strong>あなた：</strong></p>
            <p style="background: var(--bg-card); padding: 1rem; border-radius: 0.5rem; font-size: 0.9rem;">
              伏線を登録したい。<br>
              主人公が持っている古いロケット。<br>
              中には敵対者の若い頃の写真が入っている。<br>
              第3話で何気なく出して、第50話で開けて真実を知る展開。
            </p>
          </div>

          <div class="card" style="margin-top: 1rem;">
            <p><strong>AI：</strong></p>
            <p style="background: var(--bg-card); padding: 1rem; border-radius: 0.5rem; font-size: 0.9rem;">
              承知しました。以下で登録します：<br><br>
              <strong>ID:</strong> FS-03-rocket<br>
              <strong>微細度:</strong> 7（隠れ）<br>
              <strong>設置予定:</strong> EP-003<br>
              <strong>回収予定:</strong> EP-050<br><br>
              <strong>禁止キーワード:</strong><br>
              「敵の若い頃」「写真」「秘密」<br><br>
              <strong>許可表現:</strong><br>
              「古びたロケットを大切そうに触る」<br><br>
              よろしいですか？
            </p>
          </div>
        </div>

        <div>
          <h4>確認ポイント</h4>
          <div class="card">
            <ul class="checklist">
              <li>設置・回収の時期は適切か</li>
              <li>微細度は意図通りか</li>
              <li>禁止キーワードは十分か</li>
              <li>許可表現は自然か</li>
              <li>関連キャラは正しいか</li>
            </ul>
          </div>

          <div class="card" style="margin-top: 1rem;">
            <h4>強化（reinforce）の追加</h4>
            <p>必要に応じて途中で強化を入れる</p>
            <div class="example-box" style="font-size: 0.85rem; margin-top: 0.5rem;">reinforcements:
  - episode: "EP-020"
    subtlety: 5
    note: "他人がロケットに気づく"</div>
          </div>
        </div>
      </div>
    </section>

    <!-- Slide 8: Alert System -->
    <section class="slide" data-slide="8">
      <h2>伏線アラートシステム</h2>
      <p>回収忘れや長期未言及を防止</p>

      <div class="content-grid">
        <div class="card card-warning">
          <h4>回収リマインダー</h4>
          <p>回収予定の5エピソード前に通知</p>
          <div class="example-box" style="font-size: 0.85rem; margin-top: 0.5rem;">【伏線回収リマインダー】
伏線「主人公のロケット」の回収予定が
近づいています。
- 予定回収: EP-050
- 現在: EP-045
- 残り: 5エピソード</div>
        </div>

        <div class="card card-warning">
          <h4>長期未言及アラート</h4>
          <p>10エピソード以上言及なしで警告</p>
          <div class="example-box" style="font-size: 0.85rem; margin-top: 0.5rem;">【伏線強化推奨】
伏線「主人公のロケット」が
長期間言及されていません。
- 最後の言及: EP-008
- 経過: 12エピソード
読者が忘れている可能性があります。</div>
        </div>

        <div class="card card-error">
          <h4>回収漏れ最終アラート</h4>
          <p>最終話で未回収の伏線があれば警告</p>
        </div>

        <div class="card">
          <h4>意図しない伏線検出</h4>
          <p>AIが「伏線的な描写」を検出した場合に通知。登録するか削除するか選択できます。</p>
        </div>
      </div>
    </section>

    <!-- Slide 9: Visibility Config File -->
    <section class="slide" data-slide="9">
      <h2>AI可視性設定ファイル</h2>

      <div class="content-split">
        <div>
          <h4>visibility.yaml</h4>
          <div class="example-box" style="font-size: 0.75rem;">version: "1.0"
default_visibility: 3

entities:
  characters:
    アイラ:
      sections:
        基本情報: 3
        現在の状態: 3
        フェーズ別記録: 3
        隠し設定: 0

      secrets:
        - id: SEC-001
          content: "アイラは実は王族の血筋"
          visibility: 2
          forbidden_keywords:
            - "王族"
            - "血筋"
          allowed_expressions:
            - "彼女の瞳には見覚えのある光があった"

  foreshadowing:
    FS-03-rocket:
      visibility: 2

  world_settings:
    魔法体系:
      sections:
        概要: 3
        禁忌の魔法: 1</div>
        </div>

        <div>
          <div class="card">
            <h4>設定ファイルの場所</h4>
            <div class="example-box">vault/{作品名}/_ai_control/visibility.yaml</div>
          </div>

          <div class="card" style="margin-top: 1rem;">
            <h4>可視性レベル早見表</h4>
            <table>
              <tr><th>Level</th><th>AIの認識</th><th>AIの行動</th></tr>
              <tr><td><span class="vis-badge level-0">0</span></td><td>存在を知らない</td><td>何も書けない</td></tr>
              <tr><td><span class="vis-badge level-1">1</span></td><td>何かあると知る</td><td>内容に触れない</td></tr>
              <tr><td><span class="vis-badge level-2">2</span></td><td>内容を知る</td><td>暗示のみ可</td></tr>
              <tr><td><span class="vis-badge level-3">3</span></td><td>完全に把握</td><td>自由に使用</td></tr>
            </table>
          </div>
        </div>
      </div>
    </section>

    <!-- Slide 10: Exception Cases -->
    <section class="slide" data-slide="10">
      <h2>例外ケース：伏線管理</h2>

      <div class="content-grid">
        <div class="exception-box">
          <h4>伏線を回収しないことにした</h4>
          <p>ステータスを「abandoned」に変更し、理由を記録。AI可視性は Level 0 に戻ります。</p>
          <div class="example-box" style="font-size: 0.8rem; margin-top: 0.5rem;">status: abandoned
abandoned_reason: "プロット変更により不要になった"</div>
        </div>

        <div class="exception-box">
          <h4>回収時期を変更したい</h4>
          <p><code>planned_episode</code> を更新するだけ。アラートの時期も自動調整されます。</p>
        </div>

        <div class="exception-box">
          <h4>伏線が意図せず漏れた</h4>
          <p>Reviewer Agent が検出して警告します。修正するか、そのまま回収に進むか選択できます。</p>
        </div>

        <div class="exception-box">
          <h4>複数の伏線が連動する</h4>
          <p><code>prerequisite</code> で依存関係を設定。前提の伏線が回収されるまで、後続の伏線は設置不可に。</p>
          <div class="example-box" style="font-size: 0.8rem; margin-top: 0.5rem;">prerequisite:
  - "FS-08-sealed-door/revealed"  # この伏線が回収されてから</div>
        </div>
      </div>
    </section>

    <!-- Slide 11: Summary -->
    <section class="slide" data-slide="11">
      <h2>まとめ - 伏線とAI情報制御</h2>

      <div class="content-split">
        <div>
          <h3>このセクションで学んだこと</h3>
          <ul>
            <li>伏線のライフサイクル</li>
            <li>微細度スケールの使い方</li>
            <li>伏線登録の形式</li>
            <li>AI情報制御の設定</li>
            <li>アラートシステム</li>
          </ul>

          <div class="card" style="margin-top: 1.5rem;">
            <h4>初回登録での伏線</h4>
            <ul>
              <li>最初は主要な伏線だけ登録</li>
              <li>詳細は執筆しながら追加OK</li>
              <li>AI可視性は慎重に設定</li>
            </ul>
          </div>
        </div>

        <div>
          <h3>次のセクション</h3>
          <div class="card card-success">
            <h4>→ 最終チェックと例外ケース</h4>
            <p>登録完了前の最終確認と、様々な例外への対応方法。</p>
            <a href="06-finalization.html" style="color: var(--accent); font-weight: 600;">最終チェックへ進む →</a>
          </div>

          <div class="card" style="margin-top: 1rem;">
            <h4>前のセクション</h4>
            <a href="04-character-settings.html" style="color: var(--text-muted);">← キャラクター設定</a>
          </div>
        </div>
      </div>
    </section>

  </div>

  <!-- Navigation -->
  <nav class="nav">
    <button class="nav-btn" id="prev-btn" aria-label="前のスライド">←</button>
    <span class="nav-counter"><span id="current-slide">1</span> / <span id="total-slides">11</span></span>
    <button class="nav-btn" id="next-btn" aria-label="次のスライド">→</button>
  </nav>

  <div class="indicators" id="indicators"></div>

  <script>
    const slides = document.querySelectorAll('.slide');
    const totalSlides = slides.length;
    let currentSlide = 1;

    const prevBtn = document.getElementById('prev-btn');
    const nextBtn = document.getElementById('next-btn');
    const currentSlideSpan = document.getElementById('current-slide');
    const totalSlidesSpan = document.getElementById('total-slides');
    const indicatorsContainer = document.getElementById('indicators');

    totalSlidesSpan.textContent = totalSlides;

    for (let i = 1; i <= totalSlides; i++) {
      const indicator = document.createElement('div');
      indicator.className = 'indicator' + (i === 1 ? ' active' : '');
      indicator.dataset.slide = i;
      indicator.addEventListener('click', () => goToSlide(i));
      indicatorsContainer.appendChild(indicator);
    }

    function updateSlide() {
      slides.forEach((slide, index) => {
        slide.classList.toggle('active', index + 1 === currentSlide);
      });
      document.querySelectorAll('.indicator').forEach((ind, index) => {
        ind.classList.toggle('active', index + 1 === currentSlide);
      });
      currentSlideSpan.textContent = currentSlide;
      prevBtn.disabled = currentSlide === 1;
      nextBtn.disabled = currentSlide === totalSlides;
    }

    function goToSlide(n) {
      currentSlide = Math.max(1, Math.min(n, totalSlides));
      updateSlide();
    }

    function nextSlide() { if (currentSlide < totalSlides) { currentSlide++; updateSlide(); } }
    function prevSlide() { if (currentSlide > 1) { currentSlide--; updateSlide(); } }

    prevBtn.addEventListener('click', prevSlide);
    nextBtn.addEventListener('click', nextSlide);

    document.addEventListener('keydown', (e) => {
      if (e.key === 'ArrowRight' || e.key === ' ') { e.preventDefault(); nextSlide(); }
      else if (e.key === 'ArrowLeft') { e.preventDefault(); prevSlide(); }
      else if (e.key === 'Home') { e.preventDefault(); goToSlide(1); }
      else if (e.key === 'End') { e.preventDefault(); goToSlide(totalSlides); }
    });

    let touchStartX = 0;
    document.addEventListener('touchstart', (e) => { touchStartX = e.changedTouches[0].screenX; });
    document.addEventListener('touchend', (e) => {
      const diff = touchStartX - e.changedTouches[0].screenX;
      if (Math.abs(diff) > 50) { diff > 0 ? nextSlide() : prevSlide(); }
    });
  </script>
</body>
</html>
