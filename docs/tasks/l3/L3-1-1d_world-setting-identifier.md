# L3-1-1d: é–¢é€£ä¸–ç•Œè¦³è¨­å®šç‰¹å®šãƒ­ã‚¸ãƒƒã‚¯

## ãƒ¡ã‚¿æƒ…å ±

| é …ç›® | å€¤ |
|------|-----|
| ID | L3-1-1d |
| å„ªå…ˆåº¦ | P1 |
| ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ | ğŸ”² backlog |
| ä¾å­˜ã‚¿ã‚¹ã‚¯ | L3-1-1b |
| ãƒ•ã‚§ãƒ¼ã‚º | Phase Cï¼ˆå€‹åˆ¥æ©Ÿèƒ½å®Ÿè£…ï¼‰ |
| å‚ç…§ä»•æ§˜ | `docs/specs/novel-generator-v2/03_data-model.md` |

## æ¦‚è¦

ã‚·ãƒ¼ãƒ³ã«é–¢é€£ã™ã‚‹ä¸–ç•Œè¦³è¨­å®šã‚’ç‰¹å®šã—ã€ãã®ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã‚’è¿”ã™ãƒ­ã‚¸ãƒƒã‚¯ã‚’å®Ÿè£…ã™ã‚‹ã€‚
ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰æœ¬æ–‡ã¾ãŸã¯ L3 ãƒ—ãƒ­ãƒƒãƒˆã‹ã‚‰é–¢é€£è¨­å®šã‚’æŠ½å‡ºã™ã‚‹ã€‚

## å—ã‘å…¥ã‚Œæ¡ä»¶

- [ ] `identify_world_settings()` ãƒ¡ã‚½ãƒƒãƒ‰ãŒå®Ÿè£…ã•ã‚Œã¦ã„ã‚‹
- [ ] ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰æœ¬æ–‡ã‹ã‚‰ä¸–ç•Œè¦³å‚ç…§ã‚’æŠ½å‡ºã§ãã‚‹
- [ ] L3 ãƒ—ãƒ­ãƒƒãƒˆã‹ã‚‰ä¸–ç•Œè¦³å‚ç…§ã‚’æŠ½å‡ºã§ãã‚‹
- [ ] è¨­å®šåâ†’ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã®ãƒãƒƒãƒ”ãƒ³ã‚°ãŒã§ãã‚‹
- [ ] ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆãŒå­˜åœ¨ã™ã‚‹

## æŠ€è¡“çš„è©³ç´°

### ãƒ•ã‚¡ã‚¤ãƒ«é…ç½®

- å®Ÿè£…: `src/core/context/scene_resolver.py`ï¼ˆæ—¢å­˜ãƒ•ã‚¡ã‚¤ãƒ«ã«è¿½åŠ ï¼‰
- ãƒ†ã‚¹ãƒˆ: `tests/core/context/test_scene_resolver.py`ï¼ˆæ—¢å­˜ãƒ•ã‚¡ã‚¤ãƒ«ã«è¿½åŠ ï¼‰

### ãƒ¡ã‚½ãƒƒãƒ‰å®šç¾©

```python
class SceneResolver:
    # ... æ—¢å­˜ãƒ¡ã‚½ãƒƒãƒ‰ ...

    def identify_world_settings(
        self,
        scene: SceneIdentifier,
        episode_content: Optional[str] = None,
        plot_l3_content: Optional[str] = None,
    ) -> list[Path]:
        """ã‚·ãƒ¼ãƒ³ã«é–¢é€£ã™ã‚‹ä¸–ç•Œè¦³è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç‰¹å®š

        Args:
            scene: ã‚·ãƒ¼ãƒ³è­˜åˆ¥å­
            episode_content: ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰æœ¬æ–‡ï¼ˆäº‹å‰èª­ã¿è¾¼ã¿æ¸ˆã¿ã®å ´åˆï¼‰
            plot_l3_content: L3ãƒ—ãƒ­ãƒƒãƒˆå†…å®¹ï¼ˆäº‹å‰èª­ã¿è¾¼ã¿æ¸ˆã¿ã®å ´åˆï¼‰

        Returns:
            ä¸–ç•Œè¦³è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã®ãƒªã‚¹ãƒˆ
        """
        ...

    def _extract_world_references(self, content: str) -> list[str]:
        """ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‹ã‚‰ä¸–ç•Œè¦³å‚ç…§ã‚’æŠ½å‡º

        ä»¥ä¸‹ã®å½¢å¼ã‚’èªè­˜:
        - [[world/è¨­å®šå]]
        - [[è¨­å®šå]]ï¼ˆworld/ å‰æï¼‰
        - é–¢é€£è¨­å®š: è¨­å®š1, è¨­å®š2

        Args:
            content: æ¤œç´¢å¯¾è±¡ã®ãƒ†ã‚­ã‚¹ãƒˆ

        Returns:
            è¨­å®šåã®ãƒªã‚¹ãƒˆ
        """
        ...

    def _resolve_world_setting_path(self, setting_name: str) -> Optional[Path]:
        """è¨­å®šåã‹ã‚‰ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã‚’è§£æ±º

        ãƒ‘ã‚¹å½¢å¼: vault/{ä½œå“}/world/{setting_name}.md
        ã‚µãƒ–ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå¯¾å¿œ: vault/{ä½œå“}/world/{category}/{setting_name}.md

        Args:
            setting_name: è¨­å®šå

        Returns:
            ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã€å­˜åœ¨ã—ãªã‘ã‚Œã° None
        """
        ...

    def list_all_world_settings(self) -> list[Path]:
        """å…¨ä¸–ç•Œè¦³è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’åˆ—æŒ™

        Returns:
            world/ ä»¥ä¸‹ã®å…¨ .md ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆå†å¸°çš„ï¼‰
        """
        ...
```

### ä¸–ç•Œè¦³å‚ç…§ã®å½¢å¼

ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰ã‚„ L3 ãƒ—ãƒ­ãƒƒãƒˆã§ä½¿ç”¨ã•ã‚Œã‚‹å‚ç…§å½¢å¼ï¼š

```markdown
## é–¢é€£è¨­å®š
- [[world/é­”æ³•ä½“ç³»|é­”æ³•ä½“ç³»]]
- [[world/åœ°ç†/ç‹éƒ½|ç‹éƒ½]]

## æœ¬æ–‡
ç‹éƒ½ã®ä¸­å¿ƒã«ã¯å¤ã„å¡”ãŒãã³ãˆã¦ã„ãŸã€‚
```

ã¾ãŸã¯ YAML frontmatter:

```yaml
---
world_settings:
  - é­”æ³•ä½“ç³»
  - ç‹éƒ½
---
```

### ä¸–ç•Œè¦³ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 

```
vault/{ä½œå“}/world/
â”œâ”€â”€ é­”æ³•ä½“ç³».md
â”œâ”€â”€ æ­´å²/
â”‚   â”œâ”€â”€ å¤ä»£å¸å›½.md
â”‚   â””â”€â”€ å¤§æˆ¦.md
â”œâ”€â”€ åœ°ç†/
â”‚   â”œâ”€â”€ ç‹éƒ½.md
â”‚   â””â”€â”€ è¾ºå¢ƒ.md
â””â”€â”€ çµ„ç¹”/
    â”œâ”€â”€ é¨å£«å›£.md
    â””â”€â”€ é­”æ³•å­¦é™¢.md
```

### ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹

| No. | ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ | å†…å®¹ |
|-----|-------------|------|
| 1 | _extract_world_references() wikilink | `[[world/åå‰]]` |
| 2 | _extract_world_references() ã‚µãƒ–ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª | `[[world/åœ°ç†/ç‹éƒ½]]` |
| 3 | _extract_world_references() çŸ­ç¸®å½¢ | `[[åå‰]]` |
| 4 | _extract_world_references() YAML | frontmatter |
| 5 | _resolve_world_setting_path() å­˜åœ¨ | ãƒ•ã‚¡ã‚¤ãƒ«ã‚ã‚Š |
| 6 | _resolve_world_setting_path() ã‚µãƒ–ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª | éšå±¤å¯¾å¿œ |
| 7 | identify_world_settings() çµ±åˆ | å…¨å½¢å¼å¯¾å¿œ |
| 8 | list_all_world_settings() | å…¨ä»¶åˆ—æŒ™ï¼ˆå†å¸°ï¼‰ |

## å¤‰æ›´å±¥æ­´

| æ—¥ä»˜ | å¤‰æ›´å†…å®¹ |
|------|---------|
| 2026-01-26 | åˆç‰ˆä½œæˆ |
