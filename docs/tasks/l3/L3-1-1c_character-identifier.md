# L3-1-1c: é–¢é€£ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ç‰¹å®šãƒ­ã‚¸ãƒƒã‚¯

## ãƒ¡ã‚¿æƒ…å ±

| é …ç›® | å€¤ |
|------|-----|
| ID | L3-1-1c |
| å„ªå…ˆåº¦ | P1 |
| ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ | ğŸ”² backlog |
| ä¾å­˜ã‚¿ã‚¹ã‚¯ | L3-1-1b |
| ãƒ•ã‚§ãƒ¼ã‚º | Phase Cï¼ˆå€‹åˆ¥æ©Ÿèƒ½å®Ÿè£…ï¼‰ |
| å‚ç…§ä»•æ§˜ | `docs/specs/novel-generator-v2/03_data-model.md` |

## æ¦‚è¦

ã‚·ãƒ¼ãƒ³ã«ç™»å ´ã™ã‚‹ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã‚’ç‰¹å®šã—ã€ãã®ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã‚’è¿”ã™ãƒ­ã‚¸ãƒƒã‚¯ã‚’å®Ÿè£…ã™ã‚‹ã€‚
ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰æœ¬æ–‡ã¾ãŸã¯ L3 ãƒ—ãƒ­ãƒƒãƒˆã‹ã‚‰é–¢é€£ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã‚’æŠ½å‡ºã™ã‚‹ã€‚

## å—ã‘å…¥ã‚Œæ¡ä»¶

- [ ] `identify_characters()` ãƒ¡ã‚½ãƒƒãƒ‰ãŒå®Ÿè£…ã•ã‚Œã¦ã„ã‚‹
- [ ] ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰æœ¬æ–‡ã‹ã‚‰ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼å‚ç…§ã‚’æŠ½å‡ºã§ãã‚‹
- [ ] L3 ãƒ—ãƒ­ãƒƒãƒˆã‹ã‚‰ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼å‚ç…§ã‚’æŠ½å‡ºã§ãã‚‹
- [ ] ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼åâ†’ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã®ãƒãƒƒãƒ”ãƒ³ã‚°ãŒã§ãã‚‹
- [ ] ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆãŒå­˜åœ¨ã™ã‚‹

## æŠ€è¡“çš„è©³ç´°

### ãƒ•ã‚¡ã‚¤ãƒ«é…ç½®

- å®Ÿè£…: `src/core/context/scene_resolver.py`ï¼ˆæ—¢å­˜ãƒ•ã‚¡ã‚¤ãƒ«ã«è¿½åŠ ï¼‰
- ãƒ†ã‚¹ãƒˆ: `tests/core/context/test_scene_resolver.py`ï¼ˆæ—¢å­˜ãƒ•ã‚¡ã‚¤ãƒ«ã«è¿½åŠ ï¼‰

### ãƒ¡ã‚½ãƒƒãƒ‰å®šç¾©

```python
class SceneResolver:
    # ... æ—¢å­˜ãƒ¡ã‚½ãƒƒãƒ‰ ...

    def identify_characters(
        self,
        scene: SceneIdentifier,
        episode_content: Optional[str] = None,
        plot_l3_content: Optional[str] = None,
    ) -> list[Path]:
        """ã‚·ãƒ¼ãƒ³ã«é–¢é€£ã™ã‚‹ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç‰¹å®š

        Args:
            scene: ã‚·ãƒ¼ãƒ³è­˜åˆ¥å­
            episode_content: ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰æœ¬æ–‡ï¼ˆäº‹å‰èª­ã¿è¾¼ã¿æ¸ˆã¿ã®å ´åˆï¼‰
            plot_l3_content: L3ãƒ—ãƒ­ãƒƒãƒˆå†…å®¹ï¼ˆäº‹å‰èª­ã¿è¾¼ã¿æ¸ˆã¿ã®å ´åˆï¼‰

        Returns:
            ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã®ãƒªã‚¹ãƒˆ
        """
        ...

    def _extract_character_references(self, content: str) -> list[str]:
        """ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‹ã‚‰ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼å‚ç…§ã‚’æŠ½å‡º

        ä»¥ä¸‹ã®å½¢å¼ã‚’èªè­˜:
        - [[characters/ã‚­ãƒ£ãƒ©å]]
        - [[ã‚­ãƒ£ãƒ©å]]ï¼ˆcharacters/ å‰æï¼‰
        - ç™»å ´äººç‰©: ã‚­ãƒ£ãƒ©1, ã‚­ãƒ£ãƒ©2

        Args:
            content: æ¤œç´¢å¯¾è±¡ã®ãƒ†ã‚­ã‚¹ãƒˆ

        Returns:
            ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼åã®ãƒªã‚¹ãƒˆ
        """
        ...

    def _resolve_character_path(self, character_name: str) -> Optional[Path]:
        """ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼åã‹ã‚‰ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã‚’è§£æ±º

        ãƒ‘ã‚¹å½¢å¼: vault/{ä½œå“}/characters/{character_name}.md

        Args:
            character_name: ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼å

        Returns:
            ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã€å­˜åœ¨ã—ãªã‘ã‚Œã° None
        """
        ...

    def list_all_characters(self) -> list[Path]:
        """å…¨ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«ã‚’åˆ—æŒ™

        Returns:
            characters/ ä»¥ä¸‹ã®å…¨ .md ãƒ•ã‚¡ã‚¤ãƒ«
        """
        ...
```

### ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼å‚ç…§ã®å½¢å¼

ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰ã‚„ L3 ãƒ—ãƒ­ãƒƒãƒˆã§ä½¿ç”¨ã•ã‚Œã‚‹å‚ç…§å½¢å¼ï¼š

```markdown
## ç™»å ´äººç‰©
- [[characters/ã‚¢ã‚¤ãƒ©|ã‚¢ã‚¤ãƒ©]]
- [[characters/ãƒœãƒ–|ãƒœãƒ–]]

## æœ¬æ–‡
ã‚¢ã‚¤ãƒ©ã¯çª“ã®å¤–ã‚’è¦‹ã¤ã‚ã¦ã„ãŸã€‚
```

ã¾ãŸã¯ YAML frontmatter:

```yaml
---
characters:
  - ã‚¢ã‚¤ãƒ©
  - ãƒœãƒ–
---
```

### ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹

| No. | ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ | å†…å®¹ |
|-----|-------------|------|
| 1 | _extract_character_references() wikilink | `[[characters/åå‰]]` |
| 2 | _extract_character_references() çŸ­ç¸®å½¢ | `[[åå‰]]` |
| 3 | _extract_character_references() ãƒªã‚¹ãƒˆ | `ç™»å ´äººç‰©:` |
| 4 | _extract_character_references() YAML | frontmatter |
| 5 | _resolve_character_path() å­˜åœ¨ | ãƒ•ã‚¡ã‚¤ãƒ«ã‚ã‚Š |
| 6 | _resolve_character_path() ä¸åœ¨ | ãƒ•ã‚¡ã‚¤ãƒ«ãªã— |
| 7 | identify_characters() çµ±åˆ | å…¨å½¢å¼å¯¾å¿œ |
| 8 | list_all_characters() | å…¨ä»¶åˆ—æŒ™ |

## å¤‰æ›´å±¥æ­´

| æ—¥ä»˜ | å¤‰æ›´å†…å®¹ |
|------|---------|
| 2026-01-26 | åˆç‰ˆä½œæˆ |
