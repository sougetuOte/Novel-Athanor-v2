<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>最終チェックと例外ケース - 作品初回登録ガイド</title>
  <link rel="stylesheet" href="assets/styles.css">
</head>
<body>
  <a href="index.html" class="home-link">← 目次に戻る</a>

  <div class="presentation">

    <!-- Slide 1: Title -->
    <section class="slide slide-title active" data-slide="1">
      <h1>最終チェックと例外ケース</h1>
      <p class="subtitle">作品初回登録ガイド Part 6</p>
      <p class="tagline">登録完了前の最終確認</p>
    </section>

    <!-- Slide 2: Final Checklist -->
    <section class="slide" data-slide="2">
      <h2>初回登録チェックリスト</h2>
      <p>すべて確認したら執筆開始の準備完了です</p>

      <div class="content-grid">
        <div class="card">
          <h4>プロット</h4>
          <ul class="checklist">
            <li>L1プロットが承認されている</li>
            <li>L2（章構成）が作成されている</li>
            <li>第一章のL3が作成されている</li>
            <li>三幕構成が明確</li>
            <li>結末が決まっている</li>
          </ul>
        </div>

        <div class="card">
          <h4>キャラクター</h4>
          <ul class="checklist">
            <li>主人公が登録されている</li>
            <li>主要キャラが登録されている</li>
            <li>フェーズが設定されている</li>
            <li>隠し設定のAI可視性が適切</li>
            <li>関係性が定義されている</li>
          </ul>
        </div>

        <div class="card">
          <h4>ワールド設定</h4>
          <ul class="checklist">
            <li>核となる設定が登録されている</li>
            <li>最初に登場する場所がある</li>
            <li>特殊ルールが明記されている</li>
            <li>AI可視性が適切</li>
          </ul>
        </div>

        <div class="card">
          <h4>伏線・AI制御</h4>
          <ul class="checklist">
            <li>主要な伏線が登録されている</li>
            <li>設置・回収予定が設定されている</li>
            <li>禁止キーワードが設定されている</li>
            <li>visibility.yamlが作成されている</li>
          </ul>
        </div>
      </div>
    </section>

    <!-- Slide 3: Minimum Required -->
    <section class="slide" data-slide="3">
      <h2>最低限必要なもの</h2>

      <div class="concept-box">
        <h3>これだけあれば執筆開始できます</h3>
        <p class="lead">完璧を求めず、まずは最小限で始めましょう</p>
      </div>

      <div class="content-grid">
        <div class="card card-success">
          <h4>必須</h4>
          <ul>
            <li><strong>L1プロット</strong>：全体テーマと結末</li>
            <li><strong>主人公設定</strong>：基本情報のみでOK</li>
            <li><strong>第1話のL3</strong>：最初の1話分</li>
          </ul>
        </div>

        <div class="card">
          <h4>推奨</h4>
          <ul>
            <li>L2（章構成）の概要</li>
            <li>メインキャラ2-3人</li>
            <li>核となるワールド設定</li>
            <li>主要な伏線1-2個</li>
          </ul>
        </div>

        <div class="card">
          <h4>後から追加可能</h4>
          <ul>
            <li>サブキャラクター</li>
            <li>詳細なワールド設定</li>
            <li>追加の伏線</li>
            <li>詳細なL3</li>
          </ul>
        </div>
      </div>

      <div class="summary-box">
        <p><strong>ポイント</strong>：最初から完璧な設定は不要です。執筆しながら肉付けしていくのが自然な流れです。</p>
      </div>
    </section>

    <!-- Slide 4: Common Mistakes -->
    <section class="slide" data-slide="4">
      <h2>よくある間違いと対策</h2>

      <div class="content-grid">
        <div class="card card-error">
          <h4>設定を詰め込みすぎ</h4>
          <p>使わない設定まで大量に登録してしまう</p>
          <p style="color: var(--status-complete); margin-top: 0.5rem;"><strong>対策:</strong> 物語に登場するものだけ登録。必要になったら追加。</p>
        </div>

        <div class="card card-error">
          <h4>AI可視性を全部 Level 0 に</h4>
          <p>隠しすぎてAIが何も書けない</p>
          <p style="color: var(--status-complete); margin-top: 0.5rem;"><strong>対策:</strong> Level 0 は本当に重要な秘密だけ。公開情報を十分に用意。</p>
        </div>

        <div class="card card-error">
          <h4>フェーズを設定し忘れ</h4>
          <p>キャラの成長を管理できない</p>
          <p style="color: var(--status-complete); margin-top: 0.5rem;"><strong>対策:</strong> 大きな変化があるキャラは必ずフェーズを設定。</p>
        </div>

        <div class="card card-error">
          <h4>伏線の回収時期が曖昧</h4>
          <p>「いつか回収する」で放置</p>
          <p style="color: var(--status-complete); margin-top: 0.5rem;"><strong>対策:</strong> planned_episode を必ず設定。アラートが助けてくれる。</p>
        </div>
      </div>
    </section>

    <!-- Slide 5: Exception Cases 1 -->
    <section class="slide" data-slide="5">
      <h2>例外ケース集（1）</h2>

      <div class="content-grid">
        <div class="exception-box">
          <h4>シリーズもの・続編の場合</h4>
          <p>前作の設定をインポートできます。</p>
          <div class="example-box" style="font-size: 0.85rem; margin-top: 0.5rem;">1. 前作の vault をコピー
2. 必要な設定を引き継ぎ
3. 新作用に調整
4. AI可視性をリセット（回収済み伏線は Level 3 に）</div>
        </div>

        <div class="exception-box">
          <h4>共同執筆の場合</h4>
          <p>Gitで設定を共有。競合は手動マージ。</p>
          <ul>
            <li>同じ vault を Git で管理</li>
            <li>担当キャラを分担</li>
            <li>visibility.yaml の編集は慎重に</li>
          </ul>
        </div>

        <div class="exception-box">
          <h4>プロットを決めずに書きたい（パンツァー）</h4>
          <p>最低限 L1（テーマと方向性）だけ設定。L2/L3 は「未定」で登録し、執筆しながら追加。</p>
          <p style="font-size: 0.85rem; color: var(--text-muted);">伏線管理やAI支援の精度は下がりますが、可能です。</p>
        </div>

        <div class="exception-box">
          <h4>既存作品を途中から登録したい</h4>
          <p>既存エピソードをインポートし、Summary を自動生成。そこから Plot を逆算で作成できます。</p>
        </div>
      </div>
    </section>

    <!-- Slide 6: Exception Cases 2 -->
    <section class="slide" data-slide="6">
      <h2>例外ケース集（2）</h2>

      <div class="content-grid">
        <div class="exception-box">
          <h4>ジャンルによる違い</h4>
          <table>
            <tr><th>ジャンル</th><th>重視する設定</th></tr>
            <tr><td>ファンタジー</td><td>魔法体系、世界観</td></tr>
            <tr><td>ミステリー</td><td>伏線、AI可視性</td></tr>
            <tr><td>恋愛</td><td>キャラ関係、フェーズ</td></tr>
            <tr><td>現代劇</td><td>キャラ設定（世界観は最小限）</td></tr>
          </table>
        </div>

        <div class="exception-box">
          <h4>短編の場合</h4>
          <p>L2を省略可能。L1 → L3 で直接シーン構成へ。</p>
          <p style="font-size: 0.85rem; color: var(--text-muted);">キャラ設定も最小限でOK。</p>
        </div>

        <div class="exception-box">
          <h4>連載中に大幅な方向転換</h4>
          <ol style="font-size: 0.9rem;">
            <li>L1を修正</li>
            <li>整合性チェックを実行</li>
            <li>矛盾点のリストを確認</li>
            <li>必要に応じてL2/L3を修正</li>
            <li>伏線のステータスを見直し</li>
          </ol>
        </div>

        <div class="exception-box">
          <h4>設定を大量に追加したい</h4>
          <p>一度に大量追加すると整合性チェックが大変。少しずつ追加し、都度チェックを推奨。</p>
        </div>
      </div>
    </section>

    <!-- Slide 7: Troubleshooting -->
    <section class="slide" data-slide="7">
      <h2>トラブルシューティング</h2>

      <div class="content-grid">
        <div class="card card-warning">
          <h4>AIが設定と矛盾することを書く</h4>
          <p><strong>原因:</strong> AI可視性が正しく設定されていない、またはコンテキストが不足</p>
          <p><strong>対策:</strong></p>
          <ul>
            <li>visibility.yaml を確認</li>
            <li>必要な情報が Level 3 になっているか確認</li>
            <li>コンテキストに含まれているか確認</li>
          </ul>
        </div>

        <div class="card card-warning">
          <h4>伏線がうっかり漏れた</h4>
          <p><strong>原因:</strong> 禁止キーワードが不足、または類似度チェックをすり抜けた</p>
          <p><strong>対策:</strong></p>
          <ul>
            <li>Reviewer Agent の警告を確認</li>
            <li>forbidden_keywords を追加</li>
            <li>該当部分を修正</li>
          </ul>
        </div>

        <div class="card card-warning">
          <h4>フェーズが切り替わらない</h4>
          <p><strong>原因:</strong> current_phase の更新忘れ</p>
          <p><strong>対策:</strong> キャラクターファイルの current_phase を手動更新、または AI に依頼</p>
        </div>

        <div class="card card-warning">
          <h4>ファイルが見つからない</h4>
          <p><strong>原因:</strong> パスの間違い、ファイル名のタイポ</p>
          <p><strong>対策:</strong> Obsidian でリンク切れを確認、パスを修正</p>
        </div>
      </div>
    </section>

    <!-- Slide 8: After Registration -->
    <section class="slide" data-slide="8">
      <h2>登録完了後の流れ</h2>

      <div class="content-split">
        <div>
          <div class="card card-success">
            <h4>執筆開始！</h4>
            <div class="flow-vertical" style="margin: 1rem 0;">
              <div class="flow-step planning" style="width: 200px;">/planning 完了</div>
              <span class="flow-arrow-down">↓</span>
              <div class="flow-step building" style="width: 200px;">/building 開始</div>
              <span class="flow-arrow-down">↓</span>
              <div class="flow-step building" style="width: 200px;">The Relay で執筆</div>
              <span class="flow-arrow-down">↓</span>
              <div class="flow-step auditing" style="width: 200px;">レビュー・修正</div>
            </div>
          </div>
        </div>

        <div>
          <div class="card">
            <h4>執筆時のコマンド</h4>
            <div class="example-box" style="font-size: 0.85rem;">/building
# BUILDINGフェーズを開始

/athanor draft
# The Relay で下書き生成

/athanor status
# 伏線ダッシュボード表示

/athanor quality
# 品質レポート生成</div>
          </div>

          <div class="card" style="margin-top: 1rem;">
            <h4>継続的に行うこと</h4>
            <ul>
              <li>新キャラ登場時に設定追加</li>
              <li>新場所登場時に設定追加</li>
              <li>伏線アラートへの対応</li>
              <li>フェーズ切替の管理</li>
            </ul>
          </div>
        </div>
      </div>
    </section>

    <!-- Slide 9: Quick Reference -->
    <section class="slide" data-slide="9">
      <h2>クイックリファレンス</h2>

      <div class="content-split">
        <div>
          <div class="card">
            <h4>ディレクトリ構成</h4>
            <div class="example-box" style="font-size: 0.8rem;">vault/{作品名}/
├── _plot/           # プロット
├── _summary/        # サマリ（自動生成）
├── _foreshadowing/  # 伏線
├── _ai_control/     # AI制御
├── _settings/       # 各種設定
├── characters/      # キャラクター
├── world/           # ワールド設定
└── episodes/        # エピソード</div>
          </div>

          <div class="card" style="margin-top: 1rem;">
            <h4>AI可視性レベル</h4>
            <table>
              <tr><td><span class="vis-badge level-0">0</span></td><td>完全秘匿</td></tr>
              <tr><td><span class="vis-badge level-1">1</span></td><td>認識のみ</td></tr>
              <tr><td><span class="vis-badge level-2">2</span></td><td>内容認識</td></tr>
              <tr><td><span class="vis-badge level-3">3</span></td><td>使用可能</td></tr>
            </table>
          </div>
        </div>

        <div>
          <div class="card">
            <h4>伏線ステータス</h4>
            <table>
              <tr><td style="color: var(--text-muted);">registered</td><td>登録済み</td></tr>
              <tr><td style="color: var(--level-l1);">planted</td><td>設置完了</td></tr>
              <tr><td style="color: var(--level-l2);">reinforced</td><td>強化済み</td></tr>
              <tr><td style="color: var(--status-complete);">revealed</td><td>回収完了</td></tr>
              <tr><td style="color: var(--text-muted);">abandoned</td><td>破棄</td></tr>
            </table>
          </div>

          <div class="card" style="margin-top: 1rem;">
            <h4>フェーズコマンド</h4>
            <table>
              <tr><td><code>/planning</code></td><td>企画・設計</td></tr>
              <tr><td><code>/building</code></td><td>執筆</td></tr>
              <tr><td><code>/auditing</code></td><td>レビュー</td></tr>
            </table>
          </div>
        </div>
      </div>
    </section>

    <!-- Slide 10: Summary -->
    <section class="slide" data-slide="10">
      <h2>おわりに</h2>

      <div class="concept-box">
        <h3>初回登録完了おめでとうございます！</h3>
        <p class="lead">あなたの物語を始める準備が整いました</p>
      </div>

      <div class="content-split">
        <div>
          <h3>学んだこと</h3>
          <ul>
            <li>初回登録の全体フロー</li>
            <li>L1/L2/L3 プロット設計</li>
            <li>ワールド設定の登録</li>
            <li>キャラクター設定とフェーズ管理</li>
            <li>伏線管理とAI情報制御</li>
            <li>例外ケースへの対応</li>
          </ul>
        </div>

        <div>
          <h3>次のステップ</h3>
          <div class="card card-success">
            <p><strong>1.</strong> <code>/building</code> でBUILDINGフェーズへ</p>
            <p><strong>2.</strong> <code>/athanor draft</code> で第1話を執筆</p>
            <p><strong>3.</strong> AIと協力して物語を紡ぎましょう！</p>
          </div>

          <div class="summary-box" style="margin-top: 1rem; text-align: center;">
            <p class="lead">あなたが主役、AIはアシスタント</p>
            <p style="font-size: 1rem; color: var(--text-muted);">素晴らしい物語が生まれることを願っています</p>
          </div>
        </div>
      </div>

      <div style="text-align: center; margin-top: 2rem;">
        <a href="index.html" style="color: var(--accent); font-size: 1.25rem; font-weight: 600;">← 目次に戻る</a>
      </div>
    </section>

  </div>

  <!-- Navigation -->
  <nav class="nav">
    <button class="nav-btn" id="prev-btn" aria-label="前のスライド">←</button>
    <span class="nav-counter"><span id="current-slide">1</span> / <span id="total-slides">10</span></span>
    <button class="nav-btn" id="next-btn" aria-label="次のスライド">→</button>
  </nav>

  <div class="indicators" id="indicators"></div>

  <script>
    const slides = document.querySelectorAll('.slide');
    const totalSlides = slides.length;
    let currentSlide = 1;

    const prevBtn = document.getElementById('prev-btn');
    const nextBtn = document.getElementById('next-btn');
    const currentSlideSpan = document.getElementById('current-slide');
    const totalSlidesSpan = document.getElementById('total-slides');
    const indicatorsContainer = document.getElementById('indicators');

    totalSlidesSpan.textContent = totalSlides;

    for (let i = 1; i <= totalSlides; i++) {
      const indicator = document.createElement('div');
      indicator.className = 'indicator' + (i === 1 ? ' active' : '');
      indicator.dataset.slide = i;
      indicator.addEventListener('click', () => goToSlide(i));
      indicatorsContainer.appendChild(indicator);
    }

    function updateSlide() {
      slides.forEach((slide, index) => {
        slide.classList.toggle('active', index + 1 === currentSlide);
      });
      document.querySelectorAll('.indicator').forEach((ind, index) => {
        ind.classList.toggle('active', index + 1 === currentSlide);
      });
      currentSlideSpan.textContent = currentSlide;
      prevBtn.disabled = currentSlide === 1;
      nextBtn.disabled = currentSlide === totalSlides;
    }

    function goToSlide(n) {
      currentSlide = Math.max(1, Math.min(n, totalSlides));
      updateSlide();
    }

    function nextSlide() { if (currentSlide < totalSlides) { currentSlide++; updateSlide(); } }
    function prevSlide() { if (currentSlide > 1) { currentSlide--; updateSlide(); } }

    prevBtn.addEventListener('click', prevSlide);
    nextBtn.addEventListener('click', nextSlide);

    document.addEventListener('keydown', (e) => {
      if (e.key === 'ArrowRight' || e.key === ' ') { e.preventDefault(); nextSlide(); }
      else if (e.key === 'ArrowLeft') { e.preventDefault(); prevSlide(); }
      else if (e.key === 'Home') { e.preventDefault(); goToSlide(1); }
      else if (e.key === 'End') { e.preventDefault(); goToSlide(totalSlides); }
    });

    let touchStartX = 0;
    document.addEventListener('touchstart', (e) => { touchStartX = e.changedTouches[0].screenX; });
    document.addEventListener('touchend', (e) => {
      const diff = touchStartX - e.changedTouches[0].screenX;
      if (Math.abs(diff) > 50) { diff > 0 ? nextSlide() : prevSlide(); }
    });
  </script>
</body>
</html>
